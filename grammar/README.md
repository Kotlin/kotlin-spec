# Kotlin grammar

[![TeamCity (simple build status)](https://img.shields.io/teamcity/https/teamcity.jetbrains.com/e/Kotlin_Spec_GrammarMaster.svg?style=flat)](https://teamcity.jetbrains.com/viewType.html?buildTypeId=Kotlin_Spec_GrammarMaster&branch_Kotlin_dev=%3Cdefault%3E&tab=buildTypeStatusDiv)
[![GitHub license](https://img.shields.io/badge/license-Apache%20License%202.0-blue.svg?style=flat)](https://www.apache.org/licenses/LICENSE-2.0)

## Description

This subproject contains the Kotlin grammar source files in the ANTLR v4 format and the infrastructure used to test the parser generated from the grammar.
The grammar test suite includes Kotlin compiler [PSI tests](https://github.com/JetBrains/kotlin/tree/master/compiler/testData/psi), Kotlin compiler [diagnostics tests](https://github.com/JetBrains/kotlin/tree/master/compiler/testData/diagnostics/tests) and grammar [custom tests](./testData/grammar).

## How to use

The grammar testing infrastructure has the additional dependencies:

* [SVN](https://subversion.apache.org/) (tested with version 1.14.0)

To run the grammar tests, do the following:

1. Download the Kotlin compiler PSI and diagnostics tests: `./gradlew :grammar:downloadCompilerTests`;
2. Prepare the diagnostics tests: `./gradlew :grammar:prepareDiagnosticsCompilerTests`;
3. Remove the not yet included tests if you want: `./gradlew :grammar:syncWithCompilerTests`.
   If you do not do this, the previously unseen compiler tests, for which the ANTLR parse tree has not yet been built and pushed, will fail **on first run**;
4. Run the test suite: `./gradlew :grammar:test`.
   At this step, the grammar files are automatically copied to `src/main/antlr`, and parser and lexer are generated to `src/main/java/{org.jetbrains.kotlin.grammar.parser}`).

## Artifacts

After the build, the following artifacts are available:

- **`kotlin-grammar-parser-{version}.jar`** containing `KotlinLexer` and `KotlinParser` classes generated by ANTLR v4 from the grammar.

The artifacts can be downloaded from [TeamCity](https://teamcity.jetbrains.com/viewType.html?buildTypeId=Kotlin_Spec_GrammarMaster).

An additional artifact available from TeamCity is **`kotlin-grammar-tools-{version}-{buildNo}.jar`**, which represents a simple API to tokenize and parse Kotlin code (for details, see [kotlin-grammar-tools](https://github.com/Kotlin/kotlin-grammar-tools) repository).

## Contributors

- [Anastasiya Shadrina](https://github.com/shadrina)
- [Mikhail Belyaev](https://github.com/belyaev-mikhail)
- [Victor Petukhov](https://github.com/PetukhovVictor)
- [Marat Akhin](https://github.com/ice-phoenix)
